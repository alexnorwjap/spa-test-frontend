# Документация проекта SPA-Test-Frontend

## Обзор проекта

SPA-Test-Frontend представляет собой одностраничное веб-приложение (SPA), разработанное с использованием Vue.js 3. Приложение предназначено для визуализации и анализа данных из различных источников, таких как склады, доходы, заказы и продажи. Основная функциональность включает в себя отображение табличных данных с возможностью пагинации и визуализацию этих данных в виде круговых диаграмм.

## Технологии и библиотеки

### Основные технологии:
- **Vue.js 3.5.17** - прогрессивный JavaScript-фреймворк для создания пользовательских интерфейсов
- **Vite 7.0.0** - современный инструмент сборки, обеспечивающий быструю разработку
- **Pinia 3.0.3** - хранилище состояний для Vue.js (замена Vuex)
- **Vue Router 4.5.1** - официальная библиотека маршрутизации для Vue.js

### UI компоненты и визуализация:
- **Element Plus 2.10.2** - библиотека компонентов пользовательского интерфейса для Vue 3
- **ECharts 5.6.0** - мощная библиотека для визуализации данных

### Инструменты разработки:
- **ESLint 9.29.0** - инструмент для статического анализа кода
- **Prettier 3.5.3** - инструмент для форматирования кода
- **Sass 1.89.2** - препроцессор CSS
- **Pug 3.0.3** - шаблонизатор HTML

### Сетевые запросы:
- **Axios 1.10.0** - HTTP-клиент для выполнения запросов к API

## Структура проекта

```
spa-test-frontend/
├── public/                    # Статические файлы
├── src/                       # Исходный код приложения
│   ├── assets/                # Ресурсы (CSS, изображения)
│   │   └── main.css           # Основные стили приложения
│   ├── components/            # Переиспользуемые компоненты Vue
│   │   ├── FilterComponent.vue      # Компонент фильтрации данных
│   │   ├── HeaderComponent.vue      # Компонент навигации
│   │   ├── MainPieComponent.vue     # Основной компонент круговых диаграмм
│   │   ├── PeriodSelector.vue       # Компонент выбора периодов
│   │   ├── PieComponent.vue         # Базовый компонент круговой диаграммы
│   │   ├── RatePageFilter.vue       # Компонент фильтров для страницы рейтинга
│   │   └── TableComponent.vue       # Компонент таблицы данных
│   ├── router/                # Настройки маршрутизации
│   │   └── index.js           # Конфигурация маршрутов приложения
│   ├── stores/                # Управление состоянием (Pinia)
│   │   └── mainData.js        # Основное хранилище данных приложения
│   ├── views/                 # Компоненты страниц
│   │   ├── ArticlePage.vue    # Страница детальной информации об артикуле
│   │   ├── Incomes.vue        # Страница поступлений товаров
│   │   ├── Main.vue           # Главная страница с аналитикой
│   │   ├── Orders.vue         # Страница управления заказами
│   │   ├── RatePage.vue       # Страница рейтинга товаров
│   │   ├── Sales.vue          # Страница анализа продаж
│   │   └── Stocks.vue         # Страница управления остатками
│   ├── App.vue                # Корневой компонент приложения
│   └── main.js                # Точка входа приложения
├── package.json               # Зависимости и скрипты проекта
├── vite.config.js             # Конфигурация сборщика Vite
└── README.md                  # Документация проекта
```

## Схема движения данных в приложении

### Архитектура потока данных

```
main.js (Точка входа)
    ↓
    ├── Инициализация Vue приложения
    ├── Подключение Pinia (управление состоянием)
    ├── Подключение Vue Router (маршрутизация)
    ├── Подключение Element Plus (UI компоненты)
    └── Монтирование App.vue
         ↓
    App.vue (Корневой компонент)
         ├── HeaderComponent (навигация между страницами)
         └── router-view (отображение текущей страницы)
              ↓
         ┌─────────────────────────────────────────┐
         │            СТРАНИЦЫ (Views)             │
         ├─────────────────────────────────────────┤
         │ Main.vue (Главная страница)             │
         │ ├── PeriodSelector (выбор периодов)     │
         │ ├── FilterComponent (базовые фильтры)   │
         │ ├── MainPieComponent (интерактивные     │
         │ │   диаграммы с обработкой кликов)      │
         │ └── Таблицы с аналитическими данными    │
         │                                         │
         │ RatePage.vue (Рейтинг товаров)          │
         │ ├── RatePageFilter (расширенные фильтры │
         │ │   с множественным выбором)            │
         │ └── TableComponent (с пагинацией)       │
         │                                         │
         │ ArticlePage.vue (Детали артикула)       │
         │ └── Детальная информация о товаре       │
         │                                         │
         │ Orders.vue, Sales.vue, Stocks.vue,      │
         │ Incomes.vue (Остальные страницы)        │
         │ └── TableComponent (с фильтрацией       │
         │     и PieComponent для визуализации)    │
         └─────────────────────────────────────────┘
                          ↓ ↑
         ┌─────────────────────────────────────────┐
         │        ХРАНИЛИЩЕ ДАННЫХ (Store)         │
         │            mainData.js (Pinia)          │
         ├─────────────────────────────────────────┤
         │ СОСТОЯНИЕ:                              │
         │ • mainData (данные текущего периода)    │
         │ • mainDataPrev (данные предыдущего      │
         │   периода для сравнения)                │
         │ • filters (активные фильтры)            │
         │ • currentPeriod / previousPeriod        │
         │   (временные диапазоны)                 │
         │ • loading / error (состояния загрузки)  │
         │                                         │
         │ ФУНКЦИИ:                                │
         │ • fetchData() - загрузка данных с API   │
         │ • updateFilters() - обновление фильтров │
         │ • updatePeriods() - изменение периодов  │
         │ • validatePeriods() - валидация дат     │
         │ • combineDataByArticle() - группировка  │
         │ • clearFilters() - сброс фильтров       │
         └─────────────────────────────────────────┘
                          ↓ ↑
         ┌─────────────────────────────────────────┐
         │             API СЕРВЕР                  │
         │    /api/{collection} endpoints          │
         ├─────────────────────────────────────────┤
         │ Коллекции данных:                       │
         │ • /api/orders (заказы)                  │
         │ • /api/sales (продажи)                  │
         │ • /api/stocks (остатки)                 │
         │ • /api/incomes (поступления)            │
         │                                         │
         │ Параметры запроса:                      │
         │ • dateFrom, dateTo (временные периоды)  │
         │ • page, limit (пагинация)               │
         │ • key (API ключ авторизации)            │
         └─────────────────────────────────────────┘
```

### Поток данных по компонентам

1. **main.js** → Инициализация приложения и подключение всех необходимых библиотек
2. **mainData.js (Store)** → Центральное хранилище всех данных приложения
3. **Страницы (Views)** → Получают данные из store и передают их в компоненты
4. **Компоненты** → Отображают данные и обрабатывают пользовательские действия

### Основные потоки данных

#### 1. Загрузка данных:
```
API → Store.fetchData() → mainData/mainDataPrev → Computed свойства → Компоненты
```

#### 2. Фильтрация данных:
```
Пользователь → FilterComponent → Store.updateFilters() → filteredData → Компоненты
```

#### 3. Изменение периодов:
```
Пользователь → PeriodSelector → Store.updatePeriods() → API запрос → Обновление данных
```

#### 4. Навигация:
```
Пользователь → Клик по диаграмме/таблице → Router.push() → Переход на другую страницу
```

## Компоненты и их функциональность

### HeaderComponent
Компонент навигации, отображающий меню с ссылками на основные разделы приложения: Main, Rate, Stocks, Incomes, Orders и Sales.

### MainPieComponent
Интерактивный компонент для отображения круговых диаграмм с обработкой кликов. Функциональность:
- Отображение данных в виде круговой диаграммы с использованием ECharts
- Обработка кликов по элементам диаграммы с генерацией событий chart-click
- Динамическое обновление при изменении входных данных (data, title, pin)
- Watchers для автоматической перерисовки при изменении props
- Адаптивный дизайн с автоматическим изменением размера при resize окна
- Правильная очистка ресурсов при размонтировании компонента

### PieComponent
Базовый компонент для визуализации данных в виде круговой диаграммы без интерактивности. Функциональность:
- Отображение данных в виде круговой диаграммы с использованием ECharts
- Динамическое обновление при изменении входных данных (data, title, pin)
- Watchers для автоматической перерисовки при изменении props
- Адаптивный дизайн с обработчиком resize для изменения размера окна браузера
- Интерактивные подсказки при наведении на сегменты диаграммы
- Lifecycle hooks для правильной инициализации и очистки ресурсов

### TableComponent
Комплексный компонент для отображения табличных данных с расширенной функциональностью. Функциональность:
- Загрузка данных с сервера через API с предотвращением дублирующих запросов
- Отображение данных в виде таблицы с сортировкой и фильтрацией по колонкам
- Система фильтров с сохранением в localStorage и автоматическим восстановлением
- Пагинация для навигации по большим наборам данных
- Интеграция с PieComponent для визуализации данных по колонкам
- Навигация между колонками для отображения разных метрик в диаграмме
- Обработка состояний загрузки и ошибок с пользовательскими уведомлениями
- Функции очистки и сброса фильтров

### PeriodSelector
Компонент для выбора и валидации временных периодов с расширенной логикой. Функциональность:
- Выбор текущего и предыдущего периодов для сравнительного анализа
- Комплексная валидация дат с предотвращением пересечений периодов
- Функции валидации дат с запретом выбора будущих дат
- Обработчики изменений с проверкой валидности при каждом изменении
- Автоматическое обновление данных при применении новых периодов
- Синхронизация с store через watchers для двусторонней связи данных
- Отображение ошибок валидации пользователю

### RatePageFilter
Расширенный компонент фильтрации с поддержкой множественного выбора и подсчетом. Функциональность:
- Фильтрация по артикулам с множественным выбором и поиском
- Фильтрация по датам с множественным выбором и форматированием
- Фильтрация по регионам и брендам с отображением количества записей
- Динамический подсчет доступных опций на основе отфильтрованных данных
- Вычисляемые свойства для генерации списков доступных значений
- Синхронизация с store и локальным состоянием через watchers
- Функции обновления и очистки всех фильтров

### FilterComponent
Базовый компонент фильтрации данных с локальным состоянием. Функциональность:
- Фильтрация по артикулу, региону, категории и бренду
- Локальное состояние фильтров для мгновенного обновления интерфейса
- Синхронизация с главным хранилищем данных через watchers
- Функции обновления и очистки всех фильтров
- Интеграция с системой управления состоянием Pinia

## Страницы приложения

### Main (Главная страница)
Основная аналитическая страница приложения. Функциональность:
- Отображение круговых диаграмм по различным метрикам (артикулы, цены, скидки, отмены)
- Таблицы с топ-20 изменений по каждой категории
- Селектор периодов для сравнения данных
- Фильтры для детализации анализа
- Навигация к детальным страницам через клики по диаграммам и таблицам

### RatePage (Рейтинг товаров)
Страница рейтинга и анализа товаров с динамической метрикой. Функциональность:
- Получение названия метрики из query параметров URL для целевого анализа
- Группировка данных по артикулам для выбранной категории анализа
- Таблица с конфигурируемыми колонками (артикул, текущий/предыдущий период, изменения)
- Визуальные индикаторы изменений с цветовой кодировкой (зеленый/красный/серый)
- Интерактивная таблица с возможностью клика по строкам для перехода к деталям артикула
- Интеграция с PeriodSelector для изменения анализируемых периодов
- Расширенные фильтры через RatePageFilter с множественным выбором
- Круговая диаграмма для визуализации данных по выбранной метрике
- Автоматическая загрузка данных при отсутствии в store с отладочной информацией

### ArticlePage (Детали артикула)
Страница детальной информации об отдельном артикуле с расширенной аналитикой. Функциональность:
- Динамический выбор артикула из выпадающего списка всех доступных товаров
- Отображение полной информации о выбранном артикуле с форматированием полей
- Таблица сравнения показателей между текущим и предыдущим периодами
- Визуальные индикаторы изменений с цветовой кодировкой (рост/падение/стабильность)
- Интеграция с PeriodSelector для изменения анализируемых периодов
- Автоматическая загрузка данных при отсутствии в store
- Отладочная информация для разработчиков с детальным логированием

### Stocks (Остатки)
Страница управления остатками товаров на складах с автоматическим определением даты. Функциональность:
- Автоматическое получение вчерашней даты для актуальных данных об остатках
- Интеграция с TableComponent для отображения данных с пагинацией и фильтрацией
- Группировка данных по складам (warehouse_name) для круговой диаграммы
- API запросы с настраиваемыми параметрами (дата, пагинация, авторизация)
- Табличное представление с возможностью сортировки и поиска по колонкам

### Incomes (Поступления)
Страница отслеживания поступлений товаров с расширенным периодом анализа. Функциональность:
- Мониторинг поступлений товаров на склады за заданный период (2024-07-01 до 2025-07-03)
- Интеграция с TableComponent для комплексного отображения данных
- Группировка данных по складам (warehouse_name) для визуализации в круговой диаграмме
- Система фильтрации и сортировки с сохранением состояния в localStorage
- API интеграция с авторизацией и пагинацией (лимит 100 записей на страницу)

### Orders (Заказы)
Страница управления заказами с региональной аналитикой. Функциональность:
- Анализ заказов за период с 2025-07-08 по 2025-07-12
- Интеграция с TableComponent для отображения данных с расширенной функциональностью
- Группировка данных по регионам (oblast) для географической аналитики
- Круговая диаграмма распределения заказов по регионам
- Система фильтрации по колонкам с автоматическим сохранением настроек
- API запросы с авторизацией и настраиваемой пагинацией

### Sales (Продажи)
Страница анализа продаж с региональной детализацией. Функциональность:
- Аналитика продаж за расширенный период (2024-07-01 до 2025-07-03)
- Интеграция с TableComponent для комплексного анализа данных
- Группировка данных по регионам (region_name) для территориальной аналитики
- Визуализация распределения продаж через круговую диаграмму
- Система фильтров с множественным выбором и поиском
- Сравнительный анализ с возможностью сортировки по различным метрикам

## Хранилище данных (mainData.js)

### Основное хранилище Pinia
Центральное хранилище данных приложения, реализованное с использованием Pinia. Функциональность:

#### Состояние данных:
- `mainData` - основные данные заказов за текущий период
- `mainDataPrev` - данные заказов за предыдущий период для сравнения
- `loading` - состояние загрузки данных
- `error` - состояние ошибки при загрузке данных
- `filters` - активные фильтры приложения с сохранением в localStorage

#### Управление периодами:
- `currentPeriod` - текущий период для анализа данных (dateFrom, dateTo)
- `previousPeriod` - предыдущий период для сравнения (dateFrom, dateTo)
- Валидация периодов с предотвращением пересечений и некорректных дат

#### Вычисляемые данные:
- `pieDataMain` - данные для основных круговых диаграмм по ключевым метрикам
- `pieDataNew` - данные для новых круговых диаграмм с сравнением периодов
- Автоматическая группировка данных по артикулам для различных категорий анализа

#### Основные функции:
- `fetchData()` - асинхронная загрузка данных с API для обоих периодов
- `updateFilters()` - обновление фильтров с сохранением в localStorage
- `updatePeriods()` - изменение периодов анализа с валидацией
- `validatePeriods()` - комплексная валидация выбранных периодов
- `combineDataByArticle()` - группировка и агрегация данных по артикулам
- `clearFilters()` - сброс всех активных фильтров

#### Система фильтрации:
- Поддержка одиночных и множественных фильтров
- Автоматическое сохранение и восстановление из localStorage
- Фильтрация по артикулам, датам, регионам, брендам и категориям

## Интеграция с API

Приложение взаимодействует с внешним API через базовый URL `/api`. Для авторизации используется API-ключ, который передается в параметрах запроса.

### Основной эндпоинт:
- `/api/orders` - основной источник данных о заказах, используемый для всех аналитических расчетов

### Параметры запросов:
- `dateFrom` - начальная дата для фильтрации данных (формат: YYYY-MM-DD)
- `dateTo` - конечная дата для фильтрации данных (формат: YYYY-MM-DD)
- `page` - номер страницы для пагинации (по умолчанию: 1)
- `limit` - количество записей на странице (по умолчанию: 400)
- `key` - API-ключ для авторизации

### Структура данных:
Приложение работает с данными заказов, которые содержат следующие основные поля:
- `nm_id` - идентификатор артикула
- `total_price` - общая стоимость заказа
- `discount_percent` - процент скидки
- `is_cancel` - статус отмены заказа
- `date` - дата заказа
- `oblast` - регион
- `supplier_article` - артикул поставщика

### Управление периодами:
Приложение поддерживает сравнение данных между двумя периодами:
- **Текущий период** - основной период для анализа
- **Предыдущий период** - период для сравнения показателей

Данные загружаются параллельно для обоих периодов и затем обрабатываются для получения сравнительной аналитики.

## Особенности реализации

1. **Современная архитектура Vue 3**: Использование Composition API для более эффективного управления состоянием компонентов и лучшей переиспользуемости кода.

2. **Централизованное управление состоянием**: Использование Pinia для управления глобальным состоянием приложения, включая данные, фильтры и периоды.

3. **Реактивная фильтрация данных**: Система фильтров с автоматическим сохранением в localStorage и реактивным обновлением отфильтрованных данных.

4. **Сравнительная аналитика**: Возможность сравнения данных между двумя периодами с автоматическим расчетом процентных изменений.

5. **Интерактивная визуализация**: Использование ECharts для создания кликабельных круговых диаграмм с навигацией между страницами.

6. **Валидация периодов**: Комплексная система валидации выбранных периодов с предотвращением некорректных дат и пересечений.

7. **Асинхронная загрузка данных**: Параллельная загрузка данных для текущего и предыдущего периодов с обработкой состояний загрузки и ошибок.

8. **Адаптивный интерфейс**: Использование Element Plus для создания современного и отзывчивого пользовательского интерфейса.

9. **Оптимизация производительности**: Использование вычисляемых свойств (computed) для эффективного пересчета данных только при необходимости.

10. **Модульная архитектура**: Разделение логики на переиспользуемые компоненты с четким разделением ответственности.

11. **Типизированная маршрутизация**: Использование Vue Router 4 с программной навигацией и передачей параметров между страницами.

12. **Персистентность данных**: Сохранение состояния фильтров в localStorage для сохранения пользовательских предпочтений между сессиями.
